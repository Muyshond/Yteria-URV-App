{"version":3,"file":"Overview.controller.js","names":["Overview","Controller","extend","onInit","_onInit","getUser","async","_getUser","oModel","this","getView","getModel","console","log","oBinding","bindContext","undefined","execute","then","oContext","getBoundContext","error","aUsers","getObject","catch","oError","userInput","byId","userID","getValue","MessageToast","show","user","getIASUser","userdata","value","setUserDetails","grouprolerelationship","getUserCollectionsViaGroup","formattedData","Object","entries","map","_ref","group","roleCollections","result","roleCollection","response","getRolecollectionRoles","roleCollectionData","roles","roleReferences","role","name","setDataToTree","_setDataToTree","data","treeformat","_ref2","groupName","icon","children","_ref3","roleCollectionName","setModel","JSONModel","tree","_setUserDetails","setData","_getUserCollectionsViaGroup","userGroups","groups","display","roleCollectionsData","getRoleCollections","groupRoleCollections","forEach","groupReferences","samlAttributeAssignment","roleGroups","grp","attributeValue","saml","includes","push","_getIASUser","userid","fetch","json","_getRoleCollections","ok","Error","status","_getRolecollectionRoles","onSearch","_onSearch","event","searchword","getParameter","toLowerCase","expandToLevel","items","getItems","item","setHighlight","context","getBindingContext","index","indexOfItem","getProperty"],"sources":["Overview.controller.ts"],"sourcesContent":["import MessageToast from \"sap/m/MessageToast\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport { form } from \"sap/ui/layout/library\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport containsOrEquals from \"sap/ui/dom/containsOrEquals\";\n/**\n * @namespace urvfrontend.controller\n */\nexport default class Overview extends Controller {\n\n    /*eslint-disable @typescript-eslint/no-empty-function*/\n    public onInit(): void {\n\n        \n    }\n\n    \n\n\n    public async getUser() {\n\n\n        const oModel = this.getView()?.getModel() as sap.ui.model.odata.v4.ODataModel;\n        console.log(oModel)\n        const oBinding = oModel.bindContext(\"/getIASUsers(...)\", undefined, {});\n\n        oBinding.execute()\n            .then(() => {\n                const oContext = oBinding.getBoundContext();\n                if (!oContext) {\n                    console.error(\"Function execution returned an undefined context!\");\n                    return;\n                }\n\n                const aUsers = oContext.getObject();\n                console.log(\"IAS Users:\", aUsers);\n            })\n            .catch((oError: any) => {\n                console.error(\"Error fetching IAS Users:\", oError);\n            });\n        \n\n\n\n\n        const userInput = this.getView()?.byId(\"UserID\") as sap.m.Input;\n        const userID = userInput.getValue();\n        if(userID === \"\"){\n            MessageToast.show(\"Please enter a valid ID\");\n            return\n        }\n        const user = await this.getIASUser(userID);\n        const userdata = user.value?.[0]\n        //const userGroups = userdata.groups.map((group: any) => group.display); //groups deftig zetten \n        //this.getRolecollectionRoles(\"AuthGroup.Content.Admin\") //test (delete erna)\n        this.setUserDetails(userdata);\n        const grouprolerelationship = await this.getUserCollectionsViaGroup(userdata)\n        console.log(grouprolerelationship)\n\n        const formattedData = Object.entries(grouprolerelationship).map(([group, value]) => ({\n            group, \n            roleCollections: value\n\n        }));\n\n        const result: any = {}\n        for (const { group, roleCollections } of formattedData) {\n            result[group] = {}; \n    \n            for (const roleCollection of roleCollections) {\n                const response = await this.getRolecollectionRoles(roleCollection); \n                const roleCollectionData = response?.value?.[0]; \n                const roles = roleCollectionData?.roleReferences?.map((role: any) => role.name) || [];\n\n                result[group][roleCollection] = roles;\n        }\n        console.log(result)\n        this.setDataToTree(result);\n\n    }\n}\n\n\n\npublic setDataToTree(data: any) {\n    const treeformat = Object.entries(data).map(([groupName, roleCollections]) => ({\n        name: groupName,\n        icon: \"sap-icon://group\", \n        children: Object.entries(roleCollections as Record<string, string[]>).map(([roleCollectionName, roles]) => ({\n            name: roleCollectionName,\n            icon: \"sap-icon://manager\",  \n            children: (roles || []).map((role: string) => ({ \n                name: role,\n                icon: \"sap-icon://role\"  \n            }))\n        }))\n    }));\n    \n    this.getView()?.setModel(new JSONModel({ tree: treeformat }), \"TreeModel\");\n}\n\n\n\n    public setUserDetails(userdata: any) {\n        console.log(userdata)\n        let oModel = this.getView()?.getModel(\"userModel\") as JSONModel;\n        if (!oModel) {\n            oModel = new JSONModel();\n            this.getView()?.setModel(oModel, \"userModel\");\n        }\n        oModel.setData(userdata);\n    }\n\n\n\n    public async getUserCollectionsViaGroup(user: any) {\n        console.log(user)\n        const userGroups = user.groups.map((group: any) => group.display);\n        const roleCollectionsData = await this.getRoleCollections();\n        const roleCollections = roleCollectionsData?.value || [];\n        const groupRoleCollections: Record<string, string[]> = {};\n\n        userGroups.forEach((group: any) => {\n            groupRoleCollections[group] = [];\n        });\n\n        roleCollections.forEach((roleCollection: any) => {\n            if (!roleCollection.groupReferences && !roleCollection.samlAttributeAssignment) {\n                return;\n            }\n            const roleGroups = [\n                ...(roleCollection.groupReferences || []).map((grp: any) => grp.attributeValue),\n                ...(roleCollection.samlAttributeAssignment || []).map((saml: any) => saml.attributeValue)\n            ];\n            userGroups.forEach((group: any) => {\n                if (roleGroups.includes(group)) {\n                    groupRoleCollections[group].push(roleCollection.name);\n                }\n            });\n        });\n        return groupRoleCollections\n    }\n\n\n\n    \n\n\n\n    public async getIASUser(userid: string) {\n        try {\n            // const model = this.getOwnerComponent()?.getModel() as ODataModel;\n            // const bookBinding = model.getKeepAliveContext(`/getIASUser(id='${userid}')`);\n            // console.log( await bookBinding.requestObject());\n                \n            const response = await fetch(`/odata/v4/catalog/getIASUser(id='${userid}')`);\n            console.log(response);\n            \n    \n            const data = await response.json();\n            console.log(\"Users:\", data);\n            return data;\n    \n        } catch (error) {\n            console.error(\"Error :\", error);\n        }\n    }\n\n    // public async getUsers() {\n    //     try {\n    //         const response = await fetch(\"/odata/v4/catalog/getIASUsers\");\n    //         if (!response.ok) {\n    //             throw new Error(`Error: ${response.status}`);\n    //         }\n    //         const data = await response.json();\n    //         console.log(\"Fetched Users:\", data);\n    //     } catch (error) {\n    //         console.error(\"Error:\", error);\n    //     }\n    // } \n\n    public async getRoleCollections(){\n        try {\n            const response = await fetch(\"/odata/v4/catalog/getRoleCollections\");\n            if (!response.ok) {\n                throw new Error(`Error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Error:\", error);\n        }\n    }\n\n    public async getRolecollectionRoles(roleCollection: string){\n        try {\n            const response = await fetch(`/odata/v4/catalog/getRoleCollectionRoles(roleCollectionName='${roleCollection}')`);\n            if (!response.ok) {\n                throw new Error(`Error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Error:\", error);\n        }\n    }\n\n    onSearch(event: sap.ui.base.Event): void {\n        \n        const searchword: string = event.getParameter(\"newValue\")?.toLowerCase() || \"\";\n        const tree = this.byId(\"RoleTree\") as sap.m.Tree;\n        tree.expandToLevel(999); \n\n        const items = tree.getItems();\n        if (!tree) return;\n        if (!searchword) {\n            items.forEach((item: any) => item.setHighlight(\"None\"));\n            return;\n        }\n\n        items.forEach((item: any) => {\n            const context = item.getBindingContext(\"TreeModel\");\n            if (context) {\n                const index = tree.indexOfItem(item);\n                const name: string = context.getProperty(\"name\").toLowerCase();\n                if (name.includes(searchword)) {\n                    console.log(name + searchword)\n                    item.setHighlight(\"Success\")  \n                }else{\n\n                    item.setHighlight(\"None\");\n                    //tree.collapse(index);\n                }\n            }\n        });\n    }\n\n    \n\n\n}"],"mappings":"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","ignoreList":[]}