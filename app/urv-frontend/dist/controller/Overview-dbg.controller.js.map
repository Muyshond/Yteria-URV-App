{"version":3,"file":"Overview-dbg.controller.js","names":["Overview","Controller","extend","onInit","_onInit","getUser","_getUser","userInput","getView","byId","userID","getValue","MessageToast","show","user","getIASUser","userdata","value","setUserDetails","grouprolerelationship","getUserCollectionsViaGroup","console","log","formattedData","Object","entries","map","_ref","group","roleCollections","result","roleCollection","response","getRolecollectionRoles","roleCollectionData","roles","roleReferences","role","name","setDataToTree","_setDataToTree","data","treeformat","_ref2","groupName","children","_ref3","roleCollectionName","setModel","JSONModel","tree","_setUserDetails","oModel","getModel","setData","_getUserCollectionsViaGroup","userGroups","groups","display","roleCollectionsData","getRoleCollections","groupRoleCollections","forEach","groupReferences","samlAttributeAssignment","roleGroups","grp","attributeValue","saml","includes","push","_getIASUser","userid","fetch","ok","Error","status","json","error","_getRoleCollections","_getRolecollectionRoles","onSearch","_onSearch","event","searchword","getParameter","toLowerCase","expandToLevel","items","getItems","item","setHighlight","context","getBindingContext","index","indexOfItem","getProperty"],"sources":["Overview.controller.ts"],"sourcesContent":["import MessageToast from \"sap/m/MessageToast\";\nimport Controller from \"sap/ui/core/mvc/Controller\";\nimport { form } from \"sap/ui/layout/library\";\nimport JSONModel from \"sap/ui/model/json/JSONModel\";\nimport Filter from \"sap/ui/model/Filter\";\nimport FilterOperator from \"sap/ui/model/FilterOperator\";\nimport containsOrEquals from \"sap/ui/dom/containsOrEquals\";\n/**\n * @namespace urvfrontend.controller\n */\nexport default class Overview extends Controller {\n\n    /*eslint-disable @typescript-eslint/no-empty-function*/\n    public onInit(): void {\n\n    }\n\n    \n\n\n    public async getUser() {\n        const userInput = this.getView()?.byId(\"UserID\") as sap.m.Input;\n        const userID = userInput.getValue();\n        if(userID === \"\"){\n            MessageToast.show(\"Please enter a valid ID\");\n            return\n        }\n        const user = await this.getIASUser(userID);\n        const userdata = user.value?.[0]\n        //const userGroups = userdata.groups.map((group: any) => group.display); //groups deftig zetten \n        //this.getRolecollectionRoles(\"AuthGroup.Content.Admin\") //test (delete erna)\n        this.setUserDetails(userdata);\n        const grouprolerelationship = await this.getUserCollectionsViaGroup(userdata)\n        console.log(grouprolerelationship)\n\n        const formattedData = Object.entries(grouprolerelationship).map(([group, value]) => ({\n            group, \n            roleCollections: value\n\n        }));\n\n        const result: any = {}\n        for (const { group, roleCollections } of formattedData) {\n            result[group] = {}; \n    \n            for (const roleCollection of roleCollections) {\n                const response = await this.getRolecollectionRoles(roleCollection); \n                const roleCollectionData = response?.value?.[0]; \n                const roles = roleCollectionData?.roleReferences?.map((role: any) => role.name) || [];\n\n                result[group][roleCollection] = roles;\n        }\n        console.log(result)\n        this.setDataToTree(result);\n\n    }\n}\n\n\n\npublic setDataToTree(data: any) {\n    const treeformat = Object.entries(data).map(([groupName, roleCollections]) => ({\n        name: groupName,\n        children: Object.entries(roleCollections as Record<string, string[]>).map(([roleCollectionName, roles]) => ({\n            name: roleCollectionName,\n            children: (roles || []).map((role: string) => ({ name: role }))\n        }))\n    }));\n    \n    this.getView()?.setModel(new JSONModel({ tree: treeformat }), \"TreeModel\");\n}\n\n\n\n    public setUserDetails(userdata: any) {\n        let oModel = this.getView()?.getModel(\"userModel\") as JSONModel;\n        if (!oModel) {\n            oModel = new JSONModel();\n            this.getView()?.setModel(oModel, \"userModel\");\n        }\n        oModel.setData(userdata);\n    }\n\n\n\n    public async getUserCollectionsViaGroup(user: any) {\n        console.log(user)\n        const userGroups = user.groups.map((group: any) => group.display);\n        const roleCollectionsData = await this.getRoleCollections();\n        const roleCollections = roleCollectionsData?.value || [];\n        const groupRoleCollections: Record<string, string[]> = {};\n\n        userGroups.forEach((group: any) => {\n            groupRoleCollections[group] = [];\n        });\n\n        roleCollections.forEach((roleCollection: any) => {\n            if (!roleCollection.groupReferences && !roleCollection.samlAttributeAssignment) {\n                return;\n            }\n            const roleGroups = [\n                ...(roleCollection.groupReferences || []).map((grp: any) => grp.attributeValue),\n                ...(roleCollection.samlAttributeAssignment || []).map((saml: any) => saml.attributeValue)\n            ];\n            userGroups.forEach((group: any) => {\n                if (roleGroups.includes(group)) {\n                    groupRoleCollections[group].push(roleCollection.name);\n                }\n            });\n        });\n        return groupRoleCollections\n    }\n\n\n\n    \n\n\n\n    public async getIASUser(userid: string) {\n        try {\n            const response = await fetch(`/odata/v4/catalog/getIASUser(id='${userid}')`);\n            if (!response.ok) {\n                throw new Error(`Error! Status: ${response.status}`);\n            }\n    \n            const data = await response.json();\n            console.log(\"Users:\", data);\n            return data;\n    \n        } catch (error) {\n            console.error(\"Error :\", error);\n        }\n    }\n\n    // public async getUsers() {\n    //     try {\n    //         const response = await fetch(\"/odata/v4/catalog/getIASUsers\");\n    //         if (!response.ok) {\n    //             throw new Error(`Error: ${response.status}`);\n    //         }\n    //         const data = await response.json();\n    //         console.log(\"Fetched Users:\", data);\n    //     } catch (error) {\n    //         console.error(\"Error:\", error);\n    //     }\n    // } \n\n    public async getRoleCollections(){\n        try {\n            const response = await fetch(\"/odata/v4/catalog/getRoleCollections\");\n            if (!response.ok) {\n                throw new Error(`Error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Error:\", error);\n        }\n    }\n\n    public async getRolecollectionRoles(roleCollection: string){\n        try {\n            const response = await fetch(`/odata/v4/catalog/getRoleCollectionRoles(roleCollectionName='${roleCollection}')`);\n            if (!response.ok) {\n                throw new Error(`Error: ${response.status}`);\n            }\n            const data = await response.json();\n            return data;\n        } catch (error) {\n            console.error(\"Error:\", error);\n        }\n    }\n\n    onSearch(event: sap.ui.base.Event): void {\n        \n        const searchword: string = event.getParameter(\"newValue\")?.toLowerCase() || \"\";\n        const tree = this.byId(\"RoleTree\") as sap.m.Tree;\n        tree.expandToLevel(999); \n\n        const items = tree.getItems();\n        if (!tree) return;\n        if (!searchword) {\n            items.forEach((item: any) => item.setHighlight(\"None\"));\n            return;\n        }\n\n        items.forEach((item: any) => {\n            const context = item.getBindingContext(\"TreeModel\");\n            if (context) {\n                const index = tree.indexOfItem(item);\n                const name: string = context.getProperty(\"name\").toLowerCase();\n                if (name.includes(searchword)) {\n                    console.log(name + searchword)\n                    item.setHighlight(\"Success\")  \n                }else{\n\n                    item.setHighlight(\"None\");\n                    //tree.collapse(index);\n                }\n            }\n        });\n    }\n\n    \n\n\n}"],"mappings":"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","ignoreList":[]}